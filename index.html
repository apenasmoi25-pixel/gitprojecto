<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de √Ågua e Luz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen p-4">
    <div class="max-w-6xl mx-auto">
        <!-- Header -->
        <div class="bg-white rounded-lg shadow-lg p-4 md:p-6 mb-6">
            <div>
                <h1 class="text-2xl md:text-3xl font-bold text-gray-800 mb-2">Calculadora de √Ågua e Luz</h1>
                <p class="text-sm md:text-base text-gray-600 mb-4">
                    <span id="status-conexao" class="font-semibold">üî¥ N√£o configurado</span>
                </p>
                <div class="flex flex-wrap gap-2">
                    <button onclick="sincronizar()" class="flex-1 md:flex-none bg-purple-600 text-white px-3 py-2 rounded-lg text-sm font-semibold hover:bg-purple-700">
                        üîÑ Sincronizar
                    </button>
                    <button onclick="exportarDados()" class="flex-1 md:flex-none bg-green-600 text-white px-3 py-2 rounded-lg text-sm font-semibold hover:bg-green-700">
                        ‚¨áÔ∏è Exportar
                    </button>
                    <button onclick="mostrarConfig()" class="flex-1 md:flex-none bg-blue-600 text-white px-3 py-2 rounded-lg text-sm font-semibold hover:bg-blue-700">
                        ‚öôÔ∏è Configurar Firebase
                    </button>
                </div>
            </div>
        </div>

        <!-- Modal Configura√ß√£o Firebase -->
        <div id="modal-config" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
            <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Configurar Firebase</h2>
                <p class="text-sm text-gray-600 mb-4">Cole aqui as suas credenciais do Firebase:</p>
                
                <div class="mb-4">
                    <label class="block text-sm font-semibold text-gray-700 mb-2">apiKey</label>
                    <input type="text" id="config-apiKey" placeholder="AIza..." class="w-full px-4 py-2 border border-gray-300 rounded-lg text-sm">
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-semibold text-gray-700 mb-2">authDomain</label>
                    <input type="text" id="config-authDomain" placeholder="seu-projeto.firebaseapp.com" class="w-full px-4 py-2 border border-gray-300 rounded-lg text-sm">
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-semibold text-gray-700 mb-2">projectId</label>
                    <input type="text" id="config-projectId" placeholder="seu-projeto" class="w-full px-4 py-2 border border-gray-300 rounded-lg text-sm">
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-semibold text-gray-700 mb-2">storageBucket</label>
                    <input type="text" id="config-storageBucket" placeholder="seu-projeto.appspot.com" class="w-full px-4 py-2 border border-gray-300 rounded-lg text-sm">
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-semibold text-gray-700 mb-2">messagingSenderId</label>
                    <input type="text" id="config-messagingSenderId" placeholder="123456789" class="w-full px-4 py-2 border border-gray-300 rounded-lg text-sm">
                </div>
                
                <div class="mb-6">
                    <label class="block text-sm font-semibold text-gray-700 mb-2">appId</label>
                    <input type="text" id="config-appId" placeholder="1:123456789:web:abc123" class="w-full px-4 py-2 border border-gray-300 rounded-lg text-sm">
                </div>
                
                <div class="flex gap-2">
                    <button onclick="salvarConfig()" class="flex-1 bg-green-600 text-white py-3 rounded-lg font-semibold hover:bg-green-700">
                        üíæ Guardar e Conectar
                    </button>
                    <button onclick="fecharConfig()" class="flex-1 bg-gray-600 text-white py-3 rounded-lg font-semibold hover:bg-gray-700">
                        ‚ùå Cancelar
                    </button>
                </div>
            </div>
        </div>

        <!-- Aviso -->
        <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-6 rounded">
            <p class="text-blue-800 text-sm">
                <strong>‚ÑπÔ∏è Firebase:</strong> Dados sincronizados automaticamente entre todos os dispositivos em tempo real!
            </p>
        </div>

        <!-- Tabs -->
        <div class="bg-white rounded-lg shadow-lg mb-6">
            <div class="grid grid-cols-2 md:flex border-b">
                <button onclick="mudarTab('contadores')" id="tab-contadores" class="py-3 px-2 md:flex-1 md:py-4 md:px-4 text-sm md:text-base font-semibold bg-indigo-600 text-white">
                    ‚öôÔ∏è Contadores
                </button>
                <button onclick="mudarTab('leituras')" id="tab-leituras" class="py-3 px-2 md:flex-1 md:py-4 md:px-4 text-sm md:text-base font-semibold text-gray-600 hover:bg-gray-50">
                    üìÖ Leituras
                </button>
                <button onclick="mudarTab('faturas')" id="tab-faturas" class="py-3 px-2 md:flex-1 md:py-4 md:px-4 text-sm md:text-base font-semibold text-gray-600 hover:bg-gray-50">
                    üí∂ Faturas
                </button>
                <button onclick="mudarTab('calculos')" id="tab-calculos" class="py-3 px-2 md:flex-1 md:py-4 md:px-4 text-sm md:text-base font-semibold text-gray-600 hover:bg-gray-50">
                    üßÆ Calcular
                </button>
            </div>

            <div class="p-4 md:p-6">
                <!-- Tab Contadores -->
                <div id="content-contadores">
                    <div class="space-y-8">
                        <!-- Contadores √Ågua -->
                        <div>
                            <h2 class="text-xl md:text-2xl font-bold text-gray-800 mb-4">üíß Contadores de √Ågua</h2>
                            <div id="lista-agua" class="space-y-3 mb-4"></div>
                            <div class="flex gap-2">
                                <input type="text" id="nova-agua" placeholder="Nome do contador" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg text-sm md:text-base">
                                <button onclick="adicionarContadorAgua()" class="bg-blue-600 text-white px-4 md:px-6 py-2 rounded-lg text-sm md:text-base font-semibold hover:bg-blue-700 whitespace-nowrap">
                                    ‚ûï Adicionar
                                </button>
                            </div>
                        </div>

                        <!-- Contadores Luz -->
                        <div>
                            <h2 class="text-xl md:text-2xl font-bold text-gray-800 mb-4">‚ö° Contadores de Luz</h2>
                            <div id="lista-luz" class="space-y-3 mb-4"></div>
                            <div class="flex gap-2">
                                <input type="text" id="nova-luz" placeholder="Nome do contador" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg text-sm md:text-base">
                                <button onclick="adicionarContadorLuz()" class="bg-yellow-600 text-white px-4 md:px-6 py-2 rounded-lg text-sm md:text-base font-semibold hover:bg-yellow-700 whitespace-nowrap">
                                    ‚ûï Adicionar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tab Leituras -->
                <div id="content-leituras" class="hidden">
                    <h2 class="text-xl md:text-2xl font-bold text-gray-800 mb-6">Registar Leitura Mensal</h2>
                    <div class="mb-6">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Data da Leitura</label>
                        <input type="date" id="data-leitura" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div class="bg-blue-50 rounded-lg p-4">
                            <h3 class="text-lg md:text-xl font-bold text-gray-800 mb-4">üíß √Ågua (m¬≥)</h3>
                            <div id="inputs-agua" class="space-y-3"></div>
                        </div>
                        <div class="bg-yellow-50 rounded-lg p-4">
                            <h3 class="text-lg md:text-xl font-bold text-gray-800 mb-4">‚ö° Luz (kWh)</h3>
                            <div id="inputs-luz" class="space-y-3"></div>
                        </div>
                    </div>
                    <button onclick="registarLeitura()" class="w-full bg-indigo-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-indigo-700">
                        ‚ûï Registar Leitura
                    </button>
                    <div id="historico-leituras" class="mt-8"></div>
                </div>

                <!-- Tab Faturas -->
                <div id="content-faturas" class="hidden">
                    <h2 class="text-xl md:text-2xl font-bold text-gray-800 mb-6">Registar Fatura Mensal</h2>
                    <div class="max-w-2xl mx-auto">
                        <div class="mb-6">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">M√™s de Refer√™ncia</label>
                            <input type="month" id="mes-fatura" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                        </div>
                        <div class="mb-6">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">üíß Valor Total √Ågua (‚Ç¨)</label>
                            <input type="number" step="0.01" id="valor-agua" placeholder="0.00" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                        </div>
                        <div class="mb-6">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">‚ö° Valor Total Luz (‚Ç¨)</label>
                            <input type="number" step="0.01" id="valor-luz" placeholder="0.00" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                        </div>
                        <button onclick="registarFatura()" class="w-full bg-indigo-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-indigo-700">
                            ‚ûï Registar Fatura
                        </button>
                    </div>
                    <div id="historico-faturas" class="mt-8"></div>
                </div>

                <!-- Tab C√°lculos -->
                <div id="content-calculos" class="hidden">
                    <h2 class="text-xl md:text-2xl font-bold text-gray-800 mb-6">C√°lculo de Consumos e Custos</h2>
                    <div id="resultados-calculos"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Vari√°veis globais
        let db = null;
        let firebaseConfigured = false;
        let dados = {
            contadoresAgua: [{ id: 1, descricao: 'Contador √Ågua 1' }],
            contadoresLuz: [{ id: 1, descricao: 'Contador Luz 1' }],
            leituras: [],
            faturas: []
        };

        // Inicializar
        document.addEventListener('DOMContentLoaded', () => {
            tentarConectarFirebase();
            document.getElementById('data-leitura').valueAsDate = new Date();
            const hoje = new Date();
            document.getElementById('mes-fatura').value = `${hoje.getFullYear()}-${String(hoje.getMonth() + 1).padStart(2, '0')}`;
        });

        // Tentar conectar ao Firebase
        function tentarConectarFirebase() {
            const config = localStorage.getItem('firebase-config');
            if (config) {
                try {
                    const firebaseConfig = JSON.parse(config);
                    inicializarFirebase(firebaseConfig);
                } catch (e) {
                    console.error('Erro ao carregar config:', e);
                    atualizarStatus('üî¥ Erro na configura√ß√£o');
                }
            } else {
                atualizarStatus('üî¥ N√£o configurado');
                renderizar();
            }
        }

        // Inicializar Firebase
        function inicializarFirebase(config) {
            try {
                if (!firebase.apps.length) {
                    firebase.initializeApp(config);
                }
                db = firebase.firestore();
                firebaseConfigured = true;
                atualizarStatus('üü¢ Conectado');
                carregarDadosFirebase();
            } catch (e) {
                console.error('Erro Firebase:', e);
                atualizarStatus('üî¥ Erro de conex√£o');
                firebaseConfigured = false;
            }
        }

        // Atualizar status
        function atualizarStatus(texto) {
            document.getElementById('status-conexao').textContent = texto;
        }

        // Mostrar modal de configura√ß√£o
        function mostrarConfig() {
            const config = localStorage.getItem('firebase-config');
            if (config) {
                const parsed = JSON.parse(config);
                document.getElementById('config-apiKey').value = parsed.apiKey || '';
                document.getElementById('config-authDomain').value = parsed.authDomain || '';
                document.getElementById('config-projectId').value = parsed.projectId || '';
                document.getElementById('config-storageBucket').value = parsed.storageBucket || '';
                document.getElementById('config-messagingSenderId').value = parsed.messagingSenderId || '';
                document.getElementById('config-appId').value = parsed.appId || '';
            }
            document.getElementById('modal-config').classList.remove('hidden');
        }

        // Fechar modal
        function fecharConfig() {
            document.getElementById('modal-config').classList.add('hidden');
        }

        // Salvar configura√ß√£o
        function salvarConfig() {
            const config = {
                apiKey: document.getElementById('config-apiKey').value.trim(),
                authDomain: document.getElementById('config-authDomain').value.trim(),
                projectId: document.getElementById('config-projectId').value.trim(),
                storageBucket: document.getElementById('config-storageBucket').value.trim(),
                messagingSenderId: document.getElementById('config-messagingSenderId').value.trim(),
                appId: document.getElementById('config-appId').value.trim()
            };

            if (!config.apiKey || !config.projectId) {
                return alert('Preencha pelo menos apiKey e projectId');
            }

            localStorage.setItem('firebase-config', JSON.stringify(config));
            fecharConfig();
            alert('Configura√ß√£o guardada! A p√°gina ser√° recarregada.');
            location.reload();
        }

        // Carregar dados do Firebase
        async function carregarDadosFirebase() {
            if (!firebaseConfigured) return;
            
            try {
                // Carregar contadores √°gua
                const aguaDoc = await db.collection('dados').doc('contadoresAgua').get();
                if (aguaDoc.exists) {
                    dados.contadoresAgua = aguaDoc.data().lista || dados.contadoresAgua;
                }

                // Carregar contadores luz
                const luzDoc = await db.collection('dados').doc('contadoresLuz').get();
                if (luzDoc.exists) {
                    dados.contadoresLuz = luzDoc.data().lista || dados.contadoresLuz;
                }

                // Carregar leituras
                const leiturasDoc = await db.collection('dados').doc('leituras').get();
                if (leiturasDoc.exists) {
                    dados.leituras = leiturasDoc.data().lista || dados.leituras;
                }

                // Carregar faturas
                const faturasDoc = await db.collection('dados').doc('faturas').get();
                if (faturasDoc.exists) {
                    dados.faturas = faturasDoc.data().lista || dados.faturas;
                }

                renderizar();
            } catch (e) {
                console.error('Erro ao carregar:', e);
                alert('Erro ao carregar dados do Firebase');
            }
        }

        // Guardar no Firebase
        async function guardarFirebase(tipo, valor) {
            if (!firebaseConfigured) {
                alert('Firebase n√£o configurado. Clique em "Configurar Firebase"');
                return false;
            }

            try {
                await db.collection('dados').doc(tipo).set({ lista: valor });
                return true;
            } catch (e) {
                console.error('Erro ao guardar:', e);
                alert('Erro ao guardar no Firebase: ' + e.message);
                return false;
            }
        }

        // Sincronizar
        async function sincronizar() {
            if (!firebaseConfigured) {
                return alert('Configure o Firebase primeiro!');
            }
            atualizarStatus('üîÑ Sincronizando...');
            await carregarDadosFirebase();
            atualizarStatus('üü¢ Conectado');
        }

        // Mudar tab
        function mudarTab(tab) {
            ['contadores', 'leituras', 'faturas', 'calculos'].forEach(t => {
                document.getElementById(`tab-${t}`).className = 'py-3 px-2 md:flex-1 md:py-4 md:px-4 text-sm md:text-base font-semibold text-gray-600 hover:bg-gray-50';
                document.getElementById(`content-${t}`).classList.add('hidden');
            });
            document.getElementById(`tab-${tab}`).className = 'py-3 px-2 md:flex-1 md:py-4 md:px-4 text-sm md:text-base font-semibold bg-indigo-600 text-white';
            document.getElementById(`content-${tab}`).classList.remove('hidden');
            
            if (tab === 'leituras') renderizarInputsLeituras();
            if (tab === 'calculos') calcularConsumos();
        }

        // Adicionar contador √°gua
        async function adicionarContadorAgua() {
            const input = document.getElementById('nova-agua');
            if (!input.value.trim()) return alert('Insira uma descri√ß√£o');
            const novoId = Math.max(0, ...dados.contadoresAgua.map(c => c.id)) + 1;
            dados.contadoresAgua.push({ id: novoId, descricao: input.value.trim() });
            if (await guardarFirebase('contadoresAgua', dados.contadoresAgua)) {
                input.value = '';
                renderizar();
                alert('Contador adicionado!');
            }
        }

        // Adicionar contador luz
        async function adicionarContadorLuz() {
            const input = document.getElementById('nova-luz');
            if (!input.value.trim()) return alert('Insira uma descri√ß√£o');
            const novoId = Math.max(0, ...dados.contadoresLuz.map(c => c.id)) + 1;
            dados.contadoresLuz.push({ id: novoId, descricao: input.value.trim() });
            if (await guardarFirebase('contadoresLuz', dados.contadoresLuz)) {
                input.value = '';
                renderizar();
                alert('Contador adicionado!');
            }
        }

        // Remover contadores
        async function removerContadorAgua(id) {
            if (dados.contadoresAgua.length <= 1) return alert('Deve existir pelo menos um contador');
            if (!confirm('Remover este contador?')) return;
            dados.contadoresAgua = dados.contadoresAgua.filter(c => c.id !== id);
            if (await guardarFirebase('contadoresAgua', dados.contadoresAgua)) {
                renderizar();
                alert('Contador removido!');
            }
        }

        async function removerContadorLuz(id) {
            if (dados.contadoresLuz.length <= 1) return alert('Deve existir pelo menos um contador');
            if (!confirm('Remover este contador?')) return;
            dados.contadoresLuz = dados.contadoresLuz.filter(c => c.id !== id);
            if (await guardarFirebase('contadoresLuz', dados.contadoresLuz)) {
                renderizar();
                alert('Contador removido!');
            }
        }

        // Registar leitura
        async function registarLeitura() {
            const dataLeitura = document.getElementById('data-leitura').value;
            const leituraAgua = dados.contadoresAgua.map(c => ({
                contadorId: c.id,
                descricao: c.descricao,
                valor: parseFloat(document.getElementById(`leitura-agua-${c.id}`).value || 0)
            }));
            const leituraLuz = dados.contadoresLuz.map(c => ({
                contadorId: c.id,
                descricao: c.descricao,
                valor: parseFloat(document.getElementById(`leitura-luz-${c.id}`).value || 0)
            }));

            if (leituraAgua.some(l => !l.valor) || leituraLuz.some(l => !l.valor)) {
                return alert('Preencha todas as leituras');
            }

            dados.leituras.push({
                id: Date.now(),
                data: dataLeitura,
                agua: leituraAgua,
                luz: leituraLuz
            });
            dados.leituras.sort((a, b) => new Date(b.data) - new Date(a.data));
            
            if (await guardarFirebase('leituras', dados.leituras)) {
                alert('Leitura registada!');
                renderizar();
            }
        }

        // Registar fatura
        async function registarFatura() {
            const mes = document.getElementById('mes-fatura').value;
            const agua = parseFloat(document.getElementById('valor-agua').value);
            const luz = parseFloat(document.getElementById('valor-luz').value);

            if (!agua || !luz) return alert('Preencha os valores');

            dados.faturas.push({ id: Date.now(), mes, agua, luz });
            dados.faturas.sort((a, b) => b.mes.localeCompare(a.mes));
            
            if (await guardarFirebase('faturas', dados.faturas)) {
                document.getElementById('valor-agua').value = '';
                document.getElementById('valor-luz').value = '';
                alert('Fatura registada!');
                renderizar();
            }
        }

        // Exportar
        function exportarDados() {
            const dataStr = JSON.stringify(dados, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `backup-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Renderizar inputs de leituras
        function renderizarInputsLeituras() {
            const inputsAgua = document.getElementById('inputs-agua');
            const inputsLuz = document.getElementById('inputs-luz');
            
            inputsAgua.innerHTML = dados.contadoresAgua.map(c => `
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-1">${c.descricao}</label>
                    <input type="number" step="0.001" id="leitura-agua-${c.id}" placeholder="0.000" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                </div>
            `).join('');

            inputsLuz.innerHTML = dados.contadoresLuz.map(c => `
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-1">${c.descricao}</label>
                    <input type="number" step="0.001" id="leitura-luz-${c.id}" placeholder="0.000" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                </div>
            `).join('');
        }

        // Calcular consumos
        function calcularConsumos() {
            const div = document.getElementById('resultados-calculos');
            
            if (dados.leituras.length < 2) {
                div.innerHTML = '<div class="bg-yellow-50 border border-yellow-200 rounded-lg p-6 text-center"><p class="text-yellow-800 font-semibold">Necessita de pelo menos 2 leituras</p></div>';
                return;
            }

            const leituraAtual = dados.leituras[0];
            const leituraAnterior = dados.leituras[1];
            const mes = leituraAtual.data.slice(0, 7);
            const fatura = dados.faturas.find(f => f.mes === mes);

            if (!fatura) {
                div.innerHTML = '<div class="bg-yellow-50 border border-yellow-200 rounded-lg p-6 text-center"><p class="text-yellow-800 font-semibold">Fatura n√£o encontrada</p></div>';
                return;
            }

            const consumosAgua = leituraAtual.agua.map(atual => {
                const anterior = leituraAnterior.agua.find(a => a.contadorId === atual.contadorId);
                return {
                    descricao: atual.descricao,
                    consumo: atual.valor - (anterior ? anterior.valor : 0)
                };
            });

            const consumosLuz = leituraAtual.luz.map(atual => {
                const anterior = leituraAnterior.luz.find(l => l.contadorId === atual.contadorId);
                return {
                    descricao: atual.descricao,
                    consumo: atual.valor - (anterior ? anterior.valor : 0)
                };
            });

            const totalAgua = consumosAgua.reduce((s, c) => s + c.consumo, 0);
            const totalLuz = consumosLuz.reduce((s, c) => s + c.consumo, 0);

            const custosAgua = consumosAgua.map(c => ({
                ...c,
                custo: (c.consumo / totalAgua) * fatura.agua
            }));

            const custosLuz = consumosLuz.map(c => ({
                ...c,
                custo: (c.consumo / totalLuz) * fatura.luz
            }));

            div.innerHTML = `
                <div class="bg-indigo-50 border border-indigo-200 rounded-lg p-4 mb-6">
                    <p class="text-indigo-800 font-semibold text-sm md:text-base">Per√≠odo: ${new Date(leituraAnterior.data).toLocaleDateString('pt-PT')} a ${new Date(leituraAtual.data).toLocaleDateString('pt-PT')}</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div class="bg-blue-50 rounded-lg p-4 md:p-6">
                        <h3 class="text-lg md:text-xl font-bold text-gray-800 mb-4">üíß √Ågua</h3>
                        <div class="space-y-3">
                            ${custosAgua.map(item => `
                                <div class="bg-white rounded-lg p-3">
                                    <p class="font-semibold text-gray-800 text-sm md:text-base">${item.descricao}</p>
                                    <p class="text-blue-600 font-bold text-lg md:text-xl">${item.consumo.toFixed(3)} m¬≥</p>
                                    <p class="text-gray-700 text-sm md:text-base">${item.custo.toFixed(2)} ‚Ç¨</p>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    <div class="bg-yellow-50 rounded-lg p-4 md:p-6">
                        <h3 class="text-lg md:text-xl font-bold text-gray-800 mb-4">‚ö° Luz</h3>
                        <div class="space-y-3">
                            ${custosLuz.map(item => `
                                <div class="bg-white rounded-lg p-3">
                                    <p class="font-semibold text-gray-800 text-sm md:text-base">${item.descricao}</p>
                                    <p class="text-yellow-600 font-bold text-lg md:text-xl">${item.consumo.toFixed(3)} kWh</p>
                                    <p class="text-gray-700 text-sm md:text-base">${item.custo.toFixed(2)} ‚Ç¨</p>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
                <div class="bg-gray-100 border border-gray-300 rounded-lg p-4 md:p-6">
                    <h3 class="text-lg md:text-xl font-bold text-gray-800 mb-4">Totais Gerais</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <p class="text-xs md:text-sm text-gray-600">√Ågua Total</p>
                            <p class="text-lg md:text-xl font-bold text-blue-600">${totalAgua.toFixed(3)} m¬≥</p>
                            <p class="text-base md:text-lg text-gray-700">${fatura.agua.toFixed(2)} ‚Ç¨</p>
                        </div>
                        <div>
                            <p class="text-xs md:text-sm text-gray-600">Luz Total</p>
                            <p class="text-lg md:text-xl font-bold text-yellow-600">${totalLuz.toFixed(3)} kWh</p>
                            <p class="text-base md:text-lg text-gray-700">${fatura.luz.toFixed(2)} ‚Ç¨</p>
                        </div>
                        <div>
                            <p class="text-xs md:text-sm text-gray-600">Custo Total</p>
                            <p class="text-xl md:text-2xl font-bold text-indigo-600">${(fatura.agua + fatura.luz).toFixed(2)} ‚Ç¨</p>
                        </div>
                    </div>
                </div>
            `;
        }

        // Renderizar tudo
        function renderizar() {
            // Contadores √Ågua
            document.getElementById('lista-agua').innerHTML = dados.contadoresAgua.map(c => `
                <div class="flex items-center justify-between bg-blue-50 border border-blue-200 rounded-lg p-3 md:p-4">
                    <span class="font-semibold text-gray-800 text-sm md:text-base">${c.descricao}</span>
                    <button onclick="removerContadorAgua(${c.id})" class="bg-red-600 text-white p-2 rounded-lg hover:bg-red-700">üóëÔ∏è</button>
                </div>
            `).join('');

            // Contadores Luz
            document.getElementById('lista-luz').innerHTML = dados.contadoresLuz.map(c => `
                <div class="flex items-center justify-between bg-yellow-50 border border-yellow-200 rounded-lg p-3 md:p-4">
                    <span class="font-semibold text-gray-800 text-sm md:text-base">${c.descricao}</span>
                    <button onclick="removerContadorLuz(${c.id})" class="bg-red-600 text-white p-2 rounded-lg hover:bg-red-700">üóëÔ∏è</button>
                </div>
            `).join('');

            // Hist√≥rico Leituras
            if (dados.leituras.length > 0) {
                document.getElementById('historico-leituras').innerHTML = `
                    <h3 class="text-lg md:text-xl font-bold text-gray-800 mb-4">Hist√≥rico</h3>
                    <div class="space-y-3">
                        ${dados.leituras.map(l => `
                            <div class="bg-white border border-gray-200 rounded-lg p-3 md:p-4">
                                <p class="font-bold text-gray-800 mb-3 text-sm md:text-base">${new Date(l.data).toLocaleDateString('pt-PT')}</p>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-xs md:text-sm">
                                    <div>
                                        <p class="font-semibold text-blue-600 mb-2">√Ågua:</p>
                                        ${l.agua.map(a => `<p class="text-gray-600">${a.descricao}: ${a.valor.toFixed(3)} m¬≥</p>`).join('')}
                                    </div>
                                    <div>
                                        <p class="font-semibold text-yellow-600 mb-2">Luz:</p>
                                        ${l.luz.map(lz => `<p class="text-gray-600">${lz.descricao}: ${lz.valor.toFixed(3)} kWh</p>`).join('')}
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }

            // Hist√≥rico Faturas
            if (dados.faturas.length > 0) {
                document.getElementById('historico-faturas').innerHTML = `
                    <h3 class="text-lg md:text-xl font-bold text-gray-800 mb-4">Hist√≥rico</h3>
                    <div class="space-y-3 max-w-2xl mx-auto">
                        ${dados.faturas.map(f => `
                            <div class="bg-white border border-gray-200 rounded-lg p-3 md:p-4">
                                <p class="font-bold text-gray-800 mb-2 text-sm md:text-base">${new Date(f.mes + '-01').toLocaleDateString('pt-PT', { month: 'long', year: 'numeric' })}</p>
                                <div class="grid grid-cols-2 gap-4 text-xs md:text-sm">
                                    <p class="text-gray-600">√Ågua: ${f.agua.toFixed(2)} ‚Ç¨</p>
                                    <p class="text-gray-600">Luz: ${f.luz.toFixed(2)} ‚Ç¨</p>
                                </div>
                                <p class="font-bold text-indigo-600 mt-2 text-sm md:text-base">Total: ${(f.agua + f.luz).toFixed(2)} ‚Ç¨</p>
                            </div>
                        `).join('')}
                    </div>
                `;
            }
        }
    </script>
</body>
</html>