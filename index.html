<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de √Ågua e Luz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen p-4">
    <div class="max-w-6xl mx-auto">
        <!-- Header -->
        <div class="bg-white rounded-lg shadow-lg p-4 md:p-6 mb-6">
            <div>
                <h1 class="text-2xl md:text-3xl font-bold text-gray-800 mb-2">Calculadora de √Ågua e Luz</h1>
                <p class="text-sm md:text-base text-gray-600 mb-4">
                    <span id="status-conexao" class="font-semibold">üîÑ A conectar...</span>
                </p>
                <div class="flex flex-wrap gap-2">
                    <button onclick="sincronizar()" class="flex-1 md:flex-none bg-purple-600 text-white px-3 py-2 rounded-lg text-sm font-semibold hover:bg-purple-700">
                        üîÑ Sincronizar
                    </button>
                    <button onclick="exportarDados()" class="flex-1 md:flex-none bg-green-600 text-white px-3 py-2 rounded-lg text-sm font-semibold hover:bg-green-700">
                        ‚¨áÔ∏è Exportar
                    </button>
                </div>
            </div>
        </div>

        <!-- Aviso -->
        <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-6 rounded">
            <p class="text-blue-800 text-sm">
                <strong>‚ÑπÔ∏è Firebase:</strong> Dados sincronizados automaticamente entre todos os dispositivos!
            </p>
        </div>

        <!-- Tabs -->
        <div class="bg-white rounded-lg shadow-lg mb-6">
            <div class="grid grid-cols-2 md:flex border-b">
                <button onclick="mudarTab('contadores')" id="tab-contadores" class="py-3 px-2 md:flex-1 md:py-4 md:px-4 text-sm md:text-base font-semibold bg-indigo-600 text-white">
                    ‚öôÔ∏è Contadores
                </button>
                <button onclick="mudarTab('leituras')" id="tab-leituras" class="py-3 px-2 md:flex-1 md:py-4 md:px-4 text-sm md:text-base font-semibold text-gray-600 hover:bg-gray-50">
                    üìÖ Leituras
                </button>
                <button onclick="mudarTab('faturas')" id="tab-faturas" class="py-3 px-2 md:flex-1 md:py-4 md:px-4 text-sm md:text-base font-semibold text-gray-600 hover:bg-gray-50">
                    üí∂ Faturas
                </button>
                <button onclick="mudarTab('calculos')" id="tab-calculos" class="py-3 px-2 md:flex-1 md:py-4 md:px-4 text-sm md:text-base font-semibold text-gray-600 hover:bg-gray-50">
                    üßÆ Calcular
                </button>
            </div>

            <div class="p-4 md:p-6">
                <!-- Tab Contadores -->
                <div id="content-contadores">
                    <div class="space-y-8">
                        <div>
                            <h2 class="text-xl md:text-2xl font-bold text-gray-800 mb-4">üíß Contadores de √Ågua</h2>
                            <div id="lista-agua" class="space-y-3 mb-4"></div>
                            <div class="flex flex-col sm:flex-row gap-2">
                                <input type="text" id="nova-agua" placeholder="Nome do contador" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg text-sm md:text-base">
                                <button onclick="adicionarContadorAgua()" class="w-full sm:w-auto bg-blue-600 text-white px-6 py-2 rounded-lg text-sm md:text-base font-semibold hover:bg-blue-700">
                                    ‚ûï Adicionar
                                </button>
                            </div>
                        </div>

                        <div>
                            <h2 class="text-xl md:text-2xl font-bold text-gray-800 mb-4">‚ö° Contadores de Luz</h2>
                            <div id="lista-luz" class="space-y-3 mb-4"></div>
                            <div class="flex flex-col sm:flex-row gap-2">
                                <input type="text" id="nova-luz" placeholder="Nome do contador" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg text-sm md:text-base">
                                <button onclick="adicionarContadorLuz()" class="w-full sm:w-auto bg-yellow-600 text-white px-6 py-2 rounded-lg text-sm md:text-base font-semibold hover:bg-yellow-700">
                                    ‚ûï Adicionar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tab Leituras -->
                <div id="content-leituras" class="hidden">
                    <h2 class="text-xl md:text-2xl font-bold text-gray-800 mb-6">Registar Leitura Mensal</h2>
                    <div class="mb-6">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Data da Leitura</label>
                        <input type="date" id="data-leitura" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div class="bg-blue-50 rounded-lg p-4">
                            <h3 class="text-lg md:text-xl font-bold text-gray-800 mb-4">üíß √Ågua (m¬≥)</h3>
                            <div id="inputs-agua" class="space-y-3"></div>
                        </div>
                        <div class="bg-yellow-50 rounded-lg p-4">
                            <h3 class="text-lg md:text-xl font-bold text-gray-800 mb-4">‚ö° Luz (kWh)</h3>
                            <div id="inputs-luz" class="space-y-3"></div>
                        </div>
                    </div>
                    <button onclick="registarLeitura()" class="w-full bg-indigo-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-indigo-700">
                        ‚ûï Registar Leitura
                    </button>
                    <div id="historico-leituras" class="mt-8"></div>
                </div>

                <!-- Tab Faturas -->
                <div id="content-faturas" class="hidden">
                    <h2 class="text-xl md:text-2xl font-bold text-gray-800 mb-6">Registar Fatura Mensal</h2>
                    <div class="max-w-2xl mx-auto">
                        <div class="mb-6">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">M√™s de Refer√™ncia</label>
                            <input type="month" id="mes-fatura" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                        </div>
                        <div class="mb-6">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">üíß Valor Total √Ågua (‚Ç¨)</label>
                            <input type="number" step="0.01" id="valor-agua" placeholder="0.00" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                        </div>
                        <div class="mb-6">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">‚ö° Valor Total Luz (‚Ç¨)</label>
                            <input type="number" step="0.01" id="valor-luz" placeholder="0.00" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                        </div>
                        <button onclick="registarFatura()" class="w-full bg-indigo-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-indigo-700">
                            ‚ûï Registar Fatura
                        </button>
                    </div>
                    <div id="historico-faturas" class="mt-8"></div>
                </div>

                <!-- Tab C√°lculos -->
                <div id="content-calculos" class="hidden">
                    <h2 class="text-xl md:text-2xl font-bold text-gray-800 mb-6">C√°lculo de Consumos e Custos</h2>
                    <div id="resultados-calculos"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // CONFIGURA√á√ÉO FIREBASE
        const FIREBASE_CONFIG = {
            apiKey: "AIzaSyAzHEpMGVT3HtsSSgdHVcNANMdjiQMeO-g",
            authDomain: "calculadora-agua-luz.firebaseapp.com",
            projectId: "calculadora-agua-luz",
            storageBucket: "calculadora-agua-luz.firebasestorage.app",
            messagingSenderId: "931167809034",
            appId: "1:931167809034:web:d3ace9cbe99b209fc7b9f3"
        };

        let db = null;
        let firebaseConfigured = false;
        let editandoContadorAgua = null;
        let editandoContadorLuz = null;
        let editandoLeitura = null;
        let editandoFatura = null;
        let dados = {
            contadoresAgua: [{ id: 1, descricao: 'Contador √Ågua 1' }],
            contadoresLuz: [{ id: 1, descricao: 'Contador Luz 1' }],
            leituras: [],
            faturas: []
        };

        document.addEventListener('DOMContentLoaded', () => {
            inicializarFirebase();
            document.getElementById('data-leitura').valueAsDate = new Date();
            const hoje = new Date();
            document.getElementById('mes-fatura').value = `${hoje.getFullYear()}-${String(hoje.getMonth() + 1).padStart(2, '0')}`;
        });

        function inicializarFirebase() {
            try {
                if (!firebase.apps.length) {
                    firebase.initializeApp(FIREBASE_CONFIG);
                }
                db = firebase.firestore();
                firebaseConfigured = true;
                atualizarStatus('üü¢ Conectado');
                carregarDadosFirebase();
            } catch (e) {
                console.error('Erro Firebase:', e);
                atualizarStatus('üî¥ Erro: ' + e.message);
                firebaseConfigured = false;
                renderizar();
            }
        }

        function atualizarStatus(texto) {
            document.getElementById('status-conexao').textContent = texto;
        }

        async function carregarDadosFirebase() {
            if (!firebaseConfigured) return;
            
            try {
                const aguaDoc = await db.collection('dados').doc('contadoresAgua').get();
                if (aguaDoc.exists) dados.contadoresAgua = aguaDoc.data().lista || dados.contadoresAgua;

                const luzDoc = await db.collection('dados').doc('contadoresLuz').get();
                if (luzDoc.exists) dados.contadoresLuz = luzDoc.data().lista || dados.contadoresLuz;

                const leiturasDoc = await db.collection('dados').doc('leituras').get();
                if (leiturasDoc.exists) dados.leituras = leiturasDoc.data().lista || dados.leituras;

                const faturasDoc = await db.collection('dados').doc('faturas').get();
                if (faturasDoc.exists) dados.faturas = faturasDoc.data().lista || dados.faturas;

                renderizar();
            } catch (e) {
                console.error('Erro ao carregar:', e);
                atualizarStatus('üî¥ Erro ao carregar: ' + e.message);
            }
        }

        async function guardarFirebase(tipo, valor) {
            if (!firebaseConfigured) {
                alert('Firebase n√£o conectado');
                return false;
            }

            try {
                await db.collection('dados').doc(tipo).set({ lista: valor });
                return true;
            } catch (e) {
                console.error('Erro ao guardar:', e);
                alert('Erro ao guardar: ' + e.message);
                return false;
            }
        }

        async function sincronizar() {
            if (!firebaseConfigured) return alert('Firebase n√£o conectado');
            atualizarStatus('üîÑ Sincronizando...');
            await carregarDadosFirebase();
            atualizarStatus('üü¢ Conectado');
        }

        function mudarTab(tab) {
            ['contadores', 'leituras', 'faturas', 'calculos'].forEach(t => {
                document.getElementById(`tab-${t}`).className = 'py-3 px-2 md:flex-1 md:py-4 md:px-4 text-sm md:text-base font-semibold text-gray-600 hover:bg-gray-50';
                document.getElementById(`content-${t}`).classList.add('hidden');
            });
            document.getElementById(`tab-${tab}`).className = 'py-3 px-2 md:flex-1 md:py-4 md:px-4 text-sm md:text-base font-semibold bg-indigo-600 text-white';
            document.getElementById(`content-${tab}`).classList.remove('hidden');
            
            if (tab === 'leituras') renderizarInputsLeituras();
            if (tab === 'calculos') calcularConsumos();
        }

        async function adicionarContadorAgua() {
            const input = document.getElementById('nova-agua');
            if (!input.value.trim()) return alert('Insira uma descri√ß√£o');
            const novoId = Math.max(0, ...dados.contadoresAgua.map(c => c.id)) + 1;
            dados.contadoresAgua.push({ id: novoId, descricao: input.value.trim() });
            if (await guardarFirebase('contadoresAgua', dados.contadoresAgua)) {
                input.value = '';
                renderizar();
            }
        }

        async function adicionarContadorLuz() {
            const input = document.getElementById('nova-luz');
            if (!input.value.trim()) return alert('Insira uma descri√ß√£o');
            const novoId = Math.max(0, ...dados.contadoresLuz.map(c => c.id)) + 1;
            dados.contadoresLuz.push({ id: novoId, descricao: input.value.trim() });
            if (await guardarFirebase('contadoresLuz', dados.contadoresLuz)) {
                input.value = '';
                renderizar();
            }
        }

        function editarContadorAgua(id) {
            editandoContadorAgua = id;
            renderizar();
        }

        function editarContadorLuz(id) {
            editandoContadorLuz = id;
            renderizar();
        }

        async function salvarEdicaoContadorAgua(id) {
            const novaDescricao = document.getElementById(`edit-agua-${id}`).value.trim();
            if (!novaDescricao) return alert('Insira uma descri√ß√£o');
            dados.contadoresAgua = dados.contadoresAgua.map(c => 
                c.id === id ? { ...c, descricao: novaDescricao } : c
            );
            if (await guardarFirebase('contadoresAgua', dados.contadoresAgua)) {
                editandoContadorAgua = null;
                renderizar();
            }
        }

        async function salvarEdicaoContadorLuz(id) {
            const novaDescricao = document.getElementById(`edit-luz-${id}`).value.trim();
            if (!novaDescricao) return alert('Insira uma descri√ß√£o');
            dados.contadoresLuz = dados.contadoresLuz.map(c => 
                c.id === id ? { ...c, descricao: novaDescricao } : c
            );
            if (await guardarFirebase('contadoresLuz', dados.contadoresLuz)) {
                editandoContadorLuz = null;
                renderizar();
            }
        }

        function cancelarEdicaoAgua() {
            editandoContadorAgua = null;
            renderizar();
        }

        function cancelarEdicaoLuz() {
            editandoContadorLuz = null;
            renderizar();
        }

        async function removerContadorAgua(id) {
            if (dados.contadoresAgua.length <= 1) return alert('Deve existir pelo menos um contador');
            if (!confirm('Remover este contador?')) return;
            dados.contadoresAgua = dados.contadoresAgua.filter(c => c.id !== id);
            if (await guardarFirebase('contadoresAgua', dados.contadoresAgua)) renderizar();
        }

        async function removerContadorLuz(id) {
            if (dados.contadoresLuz.length <= 1) return alert('Deve existir pelo menos um contador');
            if (!confirm('Remover este contador?')) return;
            dados.contadoresLuz = dados.contadoresLuz.filter(c => c.id !== id);
            if (await guardarFirebase('contadoresLuz', dados.contadoresLuz)) renderizar();
        }

        async function registarLeitura() {
            const dataLeitura = document.getElementById('data-leitura').value;
            const leituraAgua = dados.contadoresAgua.map(c => ({
                contadorId: c.id,
                descricao: c.descricao,
                valor: parseFloat(document.getElementById(`leitura-agua-${c.id}`).value || 0)
            }));
            const leituraLuz = dados.contadoresLuz.map(c => ({
                contadorId: c.id,
                descricao: c.descricao,
                valor: parseFloat(document.getElementById(`leitura-luz-${c.id}`).value || 0)
            }));

            if (leituraAgua.some(l => !l.valor) || leituraLuz.some(l => !l.valor)) {
                return alert('Preencha todas as leituras');
            }

            dados.leituras.push({
                id: Date.now(),
                data: dataLeitura,
                agua: leituraAgua,
                luz: leituraLuz
            });
            dados.leituras.sort((a, b) => new Date(b.data) - new Date(a.data));
            
            if (await guardarFirebase('leituras', dados.leituras)) {
                alert('Leitura registada!');
                renderizar();
            }
        }

        function editarLeitura(id) {
            const leitura = dados.leituras.find(l => l.id === id);
            if (!leitura) return;
            editandoLeitura = JSON.parse(JSON.stringify(leitura));
            renderizar();
        }

        async function salvarEdicaoLeitura() {
            if (!editandoLeitura) return;
            dados.leituras = dados.leituras.map(l => 
                l.id === editandoLeitura.id ? editandoLeitura : l
            );
            dados.leituras.sort((a, b) => new Date(b.data) - new Date(a.data));
            if (await guardarFirebase('leituras', dados.leituras)) {
                editandoLeitura = null;
                renderizar();
            }
        }

        function cancelarEdicaoLeitura() {
            editandoLeitura = null;
            renderizar();
        }

        async function eliminarLeitura(id) {
            if (!confirm('Eliminar esta leitura?')) return;
            dados.leituras = dados.leituras.filter(l => l.id !== id);
            if (await guardarFirebase('leituras', dados.leituras)) renderizar();
        }

        async function registarFatura() {
            const mes = document.getElementById('mes-fatura').value;
            const agua = parseFloat(document.getElementById('valor-agua').value);
            const luz = parseFloat(document.getElementById('valor-luz').value);

            if (!agua || !luz) return alert('Preencha os valores');

            dados.faturas.push({ id: Date.now(), mes, agua, luz });
            dados.faturas.sort((a, b) => b.mes.localeCompare(a.mes));
            
            if (await guardarFirebase('faturas', dados.faturas)) {
                document.getElementById('valor-agua').value = '';
                document.getElementById('valor-luz').value = '';
                alert('Fatura registada!');
                renderizar();
            }
        }

        function editarFatura(id) {
            const fatura = dados.faturas.find(f => f.id === id);
            if (!fatura) return;
            editandoFatura = JSON.parse(JSON.stringify(fatura));
            renderizar();
        }

        async function salvarEdicaoFatura() {
            if (!editandoFatura) return;
            dados.faturas = dados.faturas.map(f => 
                f.id === editandoFatura.id ? editandoFatura : f
            );
            dados.faturas.sort((a, b) => b.mes.localeCompare(a.mes));
            if (await guardarFirebase('faturas', dados.faturas)) {
                editandoFatura = null;
                renderizar();
            }
        }

        function cancelarEdicaoFatura() {
            editandoFatura = null;
            renderizar();
        }

        async function eliminarFatura(id) {
            if (!confirm('Eliminar esta fatura?')) return;
            dados.faturas = dados.faturas.filter(f => f.id !== id);
            if (await guardarFirebase('faturas', dados.faturas)) renderizar();
        }

        function exportarDados() {
            const dataStr = JSON.stringify(dados, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `backup-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function renderizarInputsLeituras() {
            document.getElementById('inputs-agua').innerHTML = dados.contadoresAgua.map(c => `
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-1">${c.descricao}</label>
                    <input type="number" step="0.001" id="leitura-agua-${c.id}" placeholder="0.000" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                </div>
            `).join('');

            document.getElementById('inputs-luz').innerHTML = dados.contadoresLuz.map(c => `
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-1">${c.descricao}</label>
                    <input type="number" step="0.001" id="leitura-luz-${c.id}" placeholder="0.000" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                </div>
            `).join('');
        }

        function calcularConsumos() {
            const div = document.getElementById('resultados-calculos');
            
            if (dados.leituras.length < 2) {
                div.innerHTML = '<div class="bg-yellow-50 border border-yellow-200 rounded-lg p-6 text-center"><p class="text-yellow-800 font-semibold">Necessita de pelo menos 2 leituras</p></div>';
                return;
            }

            const leituraAtual = dados.leituras[0];
            const leituraAnterior = dados.leituras[1];
            const mes = leituraAtual.data.slice(0, 7);
            const fatura = dados.faturas.find(f => f.mes === mes);

            if (!fatura) {
                div.innerHTML = '<div class="bg-yellow-50 border border-yellow-200 rounded-lg p-6 text-center"><p class="text-yellow-800 font-semibold">Fatura n√£o encontrada</p></div>';
                return;
            }

            const consumosAgua = leituraAtual.agua.map(atual => {
                const anterior = leituraAnterior.agua.find(a => a.contadorId === atual.contadorId);
                return {
                    descricao: atual.descricao,
                    consumo: atual.valor - (anterior ? anterior.valor : 0)
                };
            });

            const consumosLuz = leituraAtual.luz.map(atual => {
                const anterior = leituraAnterior.luz.find(l => l.contadorId === atual.contadorId);
                return {
                    descricao: atual.descricao,
                    consumo: atual.valor - (anterior ? anterior.valor : 0)
                };
            });

            const totalAgua = consumosAgua.reduce((s, c) => s + c.consumo, 0);
            const totalLuz = consumosLuz.reduce((s, c) => s + c.consumo, 0);

            const custosAgua = consumosAgua.map(c => ({
                ...c,
                custo: (c.consumo / totalAgua) * fatura.agua
            }));

            const custosLuz = consumosLuz.map(c => ({
                ...c,
                custo: (c.consumo / totalLuz) * fatura.luz
            }));

            div.innerHTML = `
                <div class="bg-indigo-50 border border-indigo-200 rounded-lg p-4 mb-6">
                    <p class="text-indigo-800 font-semibold text-sm md:text-base">Per√≠odo: ${new Date(leituraAnterior.data).toLocaleDateString('pt-PT')} a ${new Date(leituraAtual.data).toLocaleDateString('pt-PT')}</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div class="bg-blue-50 rounded-lg p-4 md:p-6">
                        <h3 class="text-lg md:text-xl font-bold text-gray-800 mb-4">üíß √Ågua</h3>
                        <div class="space-y-3">
                            ${custosAgua.map(item => `
                                <div class="bg-white rounded-lg p-3">
                                    <p class="font-semibold text-gray-800 text-sm md:text-base">${item.descricao}</p>
                                    <p class="text-blue-600 font-bold text-lg md:text-xl">${item.consumo.toFixed(3)} m¬≥</p>
                                    <p class="text-gray-700 text-sm md:text-base">${item.custo.toFixed(2)} ‚Ç¨</p>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    <div class="bg-yellow-50 rounded-lg p-4 md:p-6">
                        <h3 class="text-lg md:text-xl font-bold text-gray-800 mb-4">‚ö° Luz</h3>
                        <div class="space-y-3">
                            ${custosLuz.map(item => `
                                <div class="bg-white rounded-lg p-3">
                                    <p class="font-semibold text-gray-800 text-sm md:text-base">${item.descricao}</p>
                                    <p class="text-yellow-600 font-bold text-lg md:text-xl">${item.consumo.toFixed(3)} kWh</p>
                                    <p class="text-gray-700 text-sm md:text-base">${item.custo.toFixed(2)} ‚Ç¨</p>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
                <div class="bg-gray-100 border border-gray-300 rounded-lg p-4 md:p-6">
                    <h3 class="text-lg md:text-xl font-bold text-gray-800 mb-4">Totais Gerais</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <p class="text-xs md:text-sm text-gray-600">√Ågua Total</p>
                            <p class="text-lg md:text-xl font-bold text-blue-600">${totalAgua.toFixed(3)} m¬≥</p>
                            <p class="text-base md:text-lg text-gray-700">${fatura.agua.toFixed(2)} ‚Ç¨</p>
                        </div>
                        <div>
                            <p class="text-xs md:text-sm text-gray-600">Luz Total</p>
                            <p class="text-lg md:text-xl font-bold text-yellow-600">${totalLuz.toFixed(3)} kWh</p>
                            <p class="text-base md:text-lg text-gray-700">${fatura.luz.toFixed(2)} ‚Ç¨</p>
                        </div>
                        <div>
                            <p class="text-xs md:text-sm text-gray-600">Custo Total</p>
                            <p class="text-xl md:text-2xl font-bold text-indigo-600">${(fatura.agua + fatura.luz).toFixed(2)} ‚Ç¨</p>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderizar() {
            // Contadores √Ågua
            document.getElementById('lista-agua').innerHTML = dados.contadoresAgua.map(c => {
                if (editandoContadorAgua === c.id) {
                    return `
                        <div class="flex flex-col sm:flex-row items-stretch sm:items-center gap-2 bg-blue-50 border border-blue-200 rounded-lg p-3 md:p-4">
                            <input type="text" id="edit-agua-${c.id}" value="${c.descricao}" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg text-sm md:text-base">
                            <div class="flex gap-2">
                                <button onclick="salvarEdicaoContadorAgua(${c.id})" class="flex-1 sm:flex-none bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 text-sm">‚úì Guardar</button>
                                <button onclick="cancelarEdicaoAgua()" class="flex-1 sm:flex-none bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 text-sm">‚úï Cancelar</button>
                            </div>
                        </div>
                    `;
                }
                return `
                    <div class="flex items-center justify-between bg-blue-50 border border-blue-200 rounded-lg p-3 md:p-4">
                        <span class="font-semibold text-gray-800 text-sm md:text-base">${c.descricao}</span>
                        <div class="flex gap-2">
                            <button onclick="editarContadorAgua(${c.id})" class="bg-blue-600 text-white p-2 rounded-lg hover:bg-blue-700">‚úèÔ∏è</button>
                            <button onclick="removerContadorAgua(${c.id})" class="bg-red-600 text-white p-2 rounded-lg hover:bg-red-700">üóëÔ∏è</button>
                        </div>
                    </div>
                `;
            }).join('');

            // Contadores Luz
            document.getElementById('lista-luz').innerHTML = dados.contadoresLuz.map(c => {
                if (editandoContadorLuz === c.id) {
                    return `
                        <div class="flex flex-col sm:flex-row items-stretch sm:items-center gap-2 bg-yellow-50 border border-yellow-200 rounded-lg p-3 md:p-4">
                            <input type="text" id="edit-luz-${c.id}" value="${c.descricao}" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg text-sm md:text-base">
                            <div class="flex gap-2">
                                <button onclick="salvarEdicaoContadorLuz(${c.id})" class="flex-1 sm:flex-none bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 text-sm">‚úì Guardar</button>
                                <button onclick="cancelarEdicaoLuz()" class="flex-1 sm:flex-none bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 text-sm">‚úï Cancelar</button>
                            </div>
                        </div>
                    `;
                }
                return `
                    <div class="flex items-center justify-between bg-yellow-50 border border-yellow-200 rounded-lg p-3 md:p-4">
                        <span class="font-semibold text-gray-800 text-sm md:text-base">${c.descricao}</span>
                        <div class="flex gap-2">
                            <button onclick="editarContadorLuz(${c.id})" class="bg-yellow-600 text-white p-2 rounded-lg hover:bg-yellow-700">‚úèÔ∏è</button>
                            <button onclick="removerContadorLuz(${c.id})" class="bg-red-600 text-white p-2 rounded-lg hover:bg-red-700">üóëÔ∏è</button>
                        </div>
                    </div>
                `;
            }).join('');

            // Hist√≥rico Leituras
            if (dados.leituras.length > 0) {
                document.getElementById('historico-leituras').innerHTML = `
                    <h3 class="text-lg md:text-xl font-bold text-gray-800 mb-4">Hist√≥rico</h3>
                    <div class="space-y-3">
                        ${dados.leituras.map(l => {
                            if (editandoLeitura && editandoLeitura.id === l.id) {
                                return `
                                    <div class="bg-white border-2 border-indigo-500 rounded-lg p-3 md:p-4">
                                        <div class="mb-4">
                                            <label class="block text-sm font-semibold text-gray-700 mb-2">Data</label>
                                            <input type="date" value="${editandoLeitura.data}" onchange="editandoLeitura.data = this.value" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                                        </div>
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                            <div>
                                                <p class="font-semibold text-blue-600 mb-3">√Ågua:</p>
                                                ${editandoLeitura.agua.map((a, idx) => `
                                                    <div class="mb-2">
                                                        <label class="text-xs text-gray-600">${a.descricao}</label>
                                                        <input type="number" step="0.001" value="${a.valor}" onchange="editandoLeitura.agua[${idx}].valor = parseFloat(this.value)" class="w-full px-3 py-1 text-sm border rounded">
                                                    </div>
                                                `).join('')}
                                            </div>
                                            <div>
                                                <p class="font-semibold text-yellow-600 mb-3">Luz:</p>
                                                ${editandoLeitura.luz.map((lz, idx) => `
                                                    <div class="mb-2">
                                                        <label class="text-xs text-gray-600">${lz.descricao}</label>
                                                        <input type="number" step="0.001" value="${lz.valor}" onchange="editandoLeitura.luz[${idx}].valor = parseFloat(this.value)" class="w-full px-3 py-1 text-sm border rounded">
                                                    </div>
                                                `).join('')}
                                            </div>
                                        </div>
                                        <div class="flex gap-2">
                                            <button onclick="salvarEdicaoLeitura()" class="flex-1 bg-green-600 text-white py-2 rounded-lg hover:bg-green-700">‚úì Guardar</button>
                                            <button onclick="cancelarEdicaoLeitura()" class="flex-1 bg-gray-600 text-white py-2 rounded-lg hover:bg-gray-700">‚úï Cancelar</button>
                                        </div>
                                    </div>
                                `;
                            }
                            return `
                                <div class="bg-white border border-gray-200 rounded-lg p-3 md:p-4">
                                    <div class="flex justify-between items-start mb-3">
                                        <p class="font-bold text-gray-800">${new Date(l.data).toLocaleDateString('pt-PT')}</p>
                                        <div class="flex gap-2">
                                            <button onclick="editarLeitura(${l.id})" class="bg-blue-600 text-white p-2 rounded-lg hover:bg-blue-700">‚úèÔ∏è</button>
                                            <button onclick="eliminarLeitura(${l.id})" class="bg-red-600 text-white p-2 rounded-lg hover:bg-red-700">üóëÔ∏è</button>
                                        </div>
                                    </div>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                        <div>
                                            <p class="font-semibold text-blue-600 mb-2">√Ågua:</p>
                                            ${l.agua.map(a => `<p class="text-gray-600">${a.descricao}: ${a.valor.toFixed(3)} m¬≥</p>`).join('')}
                                        </div>
                                        <div>
                                            <p class="font-semibold text-yellow-600 mb-2">Luz:</p>
                                            ${l.luz.map(lz => `<p class="text-gray-600">${lz.descricao}: ${lz.valor.toFixed(3)} kWh</p>`).join('')}
                                        </div>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
            }

            // Hist√≥rico Faturas
            if (dados.faturas.length > 0) {
                document.getElementById('historico-faturas').innerHTML = `
                    <h3 class="text-lg md:text-xl font-bold text-gray-800 mb-4">Hist√≥rico</h3>
                    <div class="space-y-3 max-w-2xl mx-auto">
                        ${dados.faturas.map(f => {
                            if (editandoFatura && editandoFatura.id === f.id) {
                                return `
                                    <div class="bg-white border-2 border-indigo-500 rounded-lg p-3 md:p-4">
                                        <div class="mb-4">
                                            <label class="block text-sm font-semibold text-gray-700 mb-2">M√™s</label>
                                            <input type="month" value="${editandoFatura.mes}" onchange="editandoFatura.mes = this.value" class="w-full px-4 py-2 border rounded-lg">
                                        </div>
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                            <div>
                                                <label class="block text-sm font-semibold text-gray-700 mb-2">√Ågua (‚Ç¨)</label>
                                                <input type="number" step="0.01" value="${editandoFatura.agua}" onchange="editandoFatura.agua = parseFloat(this.value)" class="w-full px-4 py-2 border rounded-lg">
                                            </div>
                                            <div>
                                                <label class="block text-sm font-semibold text-gray-700 mb-2">Luz (‚Ç¨)</label>
                                                <input type="number" step="0.01" value="${editandoFatura.luz}" onchange="editandoFatura.luz = parseFloat(this.value)" class="w-full px-4 py-2 border rounded-lg">
                                            </div>
                                        </div>
                                        <div class="flex gap-2">
                                            <button onclick="salvarEdicaoFatura()" class="flex-1 bg-green-600 text-white py-2 rounded-lg hover:bg-green-700">‚úì Guardar</button>
                                            <button onclick="cancelarEdicaoFatura()" class="flex-1 bg-gray-600 text-white py-2 rounded-lg hover:bg-gray-700">‚úï Cancelar</button>
                                        </div>
                                    </div>
                                `;
                            }
                            return `
                                <div class="bg-white border border-gray-200 rounded-lg p-3 md:p-4">
                                    <div class="flex justify-between items-start mb-2">
                                        <p class="font-bold text-gray-800">${new Date(f.mes + '-01').toLocaleDateString('pt-PT', { month: 'long', year: 'numeric' })}</p>
                                        <div class="flex gap-2">
                                            <button onclick="editarFatura(${f.id})" class="bg-blue-600 text-white p-2 rounded-lg hover:bg-blue-700">‚úèÔ∏è</button>
                                            <button onclick="eliminarFatura(${f.id})" class="bg-red-600 text-white p-2 rounded-lg hover:bg-red-700">üóëÔ∏è</button>
                                        </div>
                                    </div>
                                    <div class="grid grid-cols-2 gap-4 text-sm">
                                        <p class="text-gray-600">√Ågua: ${f.agua.toFixed(2)} ‚Ç¨</p>
                                        <p class="text-gray-600">Luz: ${f.luz.toFixed(2)} ‚Ç¨</p>
                                    </div>
                                    <p class="font-bold text-indigo-600 mt-2">Total: ${(f.agua + f.luz).toFixed(2)} ‚Ç¨</p>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
            }
        }
    </script>
</body>
</html>